<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Delivery Pro - ุงูุชูุตูู ุงูุขูู</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #f3f4f6; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        
        // ุจูุงูุงุช ููููุฉ
        const initialOrders = [
            { id: 101, customer: "ุฃุญูุฏ ุจูุงูู", phone: "0661123456", address: "ุญู ุงูุณูุงูุ ุณูุง", price: 150, status: "pending", driver: null },
            { id: 102, customer: "ุณุงุฑุฉ ุงูุนููู", phone: "0661987654", address: "ุฃูุฏุงูุ ุงูุฑุจุงุท", price: 300, status: "pending", driver: null },
            { id: 103, customer: "ูุฑูู ุงูุชุงุฒู", phone: "0661000000", address: "ุญู ุงูุฑูุงุถุ ุงูุฑุจุงุท", price: 120, status: "delivered", driver: "ุนูุฑ" },
            { id: 104, customer: "ููู ุงูุดุงูู", phone: "0661112233", address: "ุชุงุจุฑููุชุ ุณูุง", price: 200, status: "pending", driver: null },
            { id: 105, customer: "ููุณู ุงูุนูุฑุงูู", phone: "0661445566", address: "ุงููุญูุทุ ุงูุฑุจุงุท", price: 450, status: "assigned", driver: "ุฎุงูุฏ" },
        ];

        const driversList = [
            { id: 1, name: "ุนูุฑ (ูุชุงุญ)", available: true },
            { id: 2, name: "ุฎุงูุฏ (ูุดุบูู)", available: false },
            { id: 3, name: "ูุงุณูู (ูุชุงุญ)", available: true }
        ];

        function SmartDeliveryApp() {
            const [orders, setOrders] = React.useState(initialOrders);
            const [view, setView] = React.useState('admin'); 
            
            // --- ุตูุงุฏูู ุงูุชุญูู (OTP) ---
            const [showOtpModal, setShowOtpModal] = React.useState(false);
            const [currentOrderId, setCurrentOrderId] = React.useState(null);
            const [otpInput, setOtpInput] = React.useState("");
            const [verificationCode, setVerificationCode] = React.useState(""); // ุงูููุฏ ุงูุตุญูุญ

            // --- ุฅุญุตุงุฆูุงุช ---
            const stats = {
                total: orders.length,
                pending: orders.filter(o => o.status === 'pending').length,
                delivered: orders.filter(o => o.status === 'delivered').length,
                revenue: orders.filter(o => o.status === 'delivered').reduce((acc, curr) => acc + curr.price, 0)
            };

            // --- ุชูุฒูุน ุฐูู ---
            const autoAssign = () => {
                const newOrders = [...orders];
                const availableDrivers = driversList.filter(d => d.available);
                let driverIndex = 0, count = 0;
                newOrders.forEach(order => {
                    if (order.status === 'pending' && availableDrivers.length > 0) {
                        order.driver = availableDrivers[driverIndex].name;
                        order.status = 'assigned';
                        driverIndex = (driverIndex + 1) % availableDrivers.length;
                        count++;
                    }
                });
                setOrders(newOrders);
                alert(count > 0 ? `๐ค ุชู ุชูุฒูุน ${count} ุทูุจุงุช ุจูุฌุงุญ!` : "ูุง ุชูุฌุฏ ุทูุจุงุช ุฌุฏูุฏุฉ.");
            };

            // --- 1. ูุธููุฉ ุงูุงุชุตุงู (ูุงุชู / ูุงุชุณุงุจ) ---
            const handleContact = (phone, name) => {
                // ูุญุงูุงุฉ ุงูุฎูุงุฑ
                const choice = confirm(`ูู ุชุฑูุฏ ุงูุงุชุตุงู ุจู ${name}ุ\n\n[OK] = ูุชุญ ูุงุชุณุงุจ\n[Cancel] = ุงุชุตุงู ูุงุชูู`);
                if (choice) {
                    window.open(`https://wa.me/212${phone.substring(1)}`, '_blank');
                } else {
                    window.location.href = `tel:${phone}`;
                }
            };

            // --- 2. ุจุฏุก ุนูููุฉ ุงูุชุณููู (ุทูุจ ุงูููุฏ) ---
            const initiateDelivery = (orderId) => {
                // ุชูููุฏ ููุฏ ุนุดูุงุฆู ูู 4 ุฃุฑูุงู
                const code = Math.floor(1000 + Math.random() * 9000).toString();
                setVerificationCode(code);
                setCurrentOrderId(orderId);
                
                // ูุญุงูุงุฉ ุฅุฑุณุงู SMS (ูุฐุง ูุง ุณุชูููู ููุฌูุฉ)
                alert(`๐จ [ูุธุงู ุงููุญุงูุงุฉ]:\nุชู ุฅุฑุณุงู ุฑุณุงูุฉ SMS ููุฒุจูู ุจุงูููุฏ: ${code}\n\n(ุงูููุฒุน ุณูุทูุจ ูุฐุง ุงูููุฏ ูู ุงูุฒุจูู ุงูุขู)`);
                
                setShowOtpModal(true);
            };

            // --- 3. ุงูุชุญูู ูู ุงูููุฏ ---
            const verifyAndDeliver = () => {
                if (otpInput === verificationCode) {
                    // ููุฏ ุตุญูุญ
                    setOrders(orders.map(o => o.id === currentOrderId ? { ...o, status: 'delivered' } : o));
                    setShowOtpModal(false);
                    setOtpInput("");
                    // ุตูุช ูุฌุงุญ (ุงุฎุชูุงุฑู)
                    alert("โ ููุฏ ุตุญูุญ! ุชู ุชุฃููุฏ ุงูุชุณููู ุจูุฌุงุญ.");
                } else {
                    alert("โ ููุฏ ุฎุงุทุฆ! ุงููุฑุฌู ุงูุทูุจ ูู ุงูุฒุจูู ุงูุชุญูู ูู ุงูุฑุณุงูุฉ.");
                }
            };

            return (
                <div className="flex h-screen overflow-hidden bg-gray-50">
                    
                    {/* Sidebar */}
                    <aside className="w-64 bg-slate-900 text-white flex-col hidden md:flex">
                        <div className="p-6 text-2xl font-bold border-b border-gray-700 text-center">
                            ุชูุตูู <span className="text-green-400">Secure</span>
                        </div>
                        <nav className="flex-1 p-4 space-y-3">
                            <button onClick={() => setView('admin')} className={`w-full text-right p-3 rounded-lg flex items-center gap-3 ${view === 'admin' ? 'bg-blue-600' : 'hover:bg-slate-800'}`}>
                                <i className="fa-solid fa-chart-pie"></i> ุงูุฅุฏุงุฑุฉ ุงููุฑูุฒูุฉ
                            </button>
                            <button onClick={() => setView('driver')} className={`w-full text-right p-3 rounded-lg flex items-center gap-3 ${view === 'driver' ? 'bg-green-600' : 'hover:bg-slate-800'}`}>
                                <i className="fa-solid fa-mobile-screen"></i> ุชุทุจูู ุงูููุฒุน
                            </button>
                        </nav>
                        <div className="p-4 text-xs text-gray-500 text-center">v2.0 Security Module</div>
                    </aside>

                    {/* Main */}
                    <main className="flex-1 flex flex-col h-screen overflow-y-auto">
                        
                        {/* Mobile Header */}
                        <div className="md:hidden bg-white p-4 shadow flex justify-between items-center">
                            <h1 className="font-bold text-lg">ุชูุตูู Secure</h1>
                            <div className="flex gap-2">
                                <button onClick={() => setView('admin')} className="px-3 py-1 bg-gray-100 rounded text-sm">ุฅุฏุงุฑุฉ</button>
                                <button onClick={() => setView('driver')} className="px-3 py-1 bg-green-100 text-green-700 rounded text-sm">ููุฒุน</button>
                            </div>
                        </div>

                        {/* === ADMIN VIEW === */}
                        {view === 'admin' && (
                            <div className="p-8 animate-fade-in">
                                <div className="flex justify-between items-center mb-8">
                                    <h2 className="text-3xl font-bold text-gray-800">ููุญุฉ ุงูุชุญูู</h2>
                                    <button onClick={autoAssign} className="bg-indigo-600 text-white px-5 py-2 rounded-lg hover:bg-indigo-700 shadow-lg flex items-center gap-2">
                                        <i className="fa-solid fa-robot"></i> ุชูุฒูุน ุชููุงุฆู
                                    </button>
                                </div>

                                <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                                    <div className="bg-white p-5 rounded-xl shadow-sm border-r-4 border-blue-500">
                                        <div className="text-gray-500 text-sm">ุงูุทูุจุงุช</div>
                                        <div className="text-2xl font-bold">{stats.total}</div>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl shadow-sm border-r-4 border-yellow-500">
                                        <div className="text-gray-500 text-sm">ุงูุชุธุงุฑ</div>
                                        <div className="text-2xl font-bold">{stats.pending}</div>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl shadow-sm border-r-4 border-green-500">
                                        <div className="text-gray-500 text-sm">ููุชููุฉ</div>
                                        <div className="text-2xl font-bold">{stats.delivered}</div>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl shadow-sm border-r-4 border-purple-500">
                                        <div className="text-gray-500 text-sm">ุงููุฏุงุฎูู</div>
                                        <div className="text-2xl font-bold">{stats.revenue} DH</div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow overflow-hidden">
                                    <table className="w-full text-right">
                                        <thead className="bg-gray-50 text-gray-600 text-sm">
                                            <tr>
                                                <th className="p-4">ID</th>
                                                <th className="p-4">ุงูุฒุจูู</th>
                                                <th className="p-4">ุงูุณุนุฑ</th>
                                                <th className="p-4">ุงูุญุงูุฉ</th>
                                                <th className="p-4">ุงูููุฒุน</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {orders.map(o => (
                                                <tr key={o.id} className="border-t hover:bg-gray-50">
                                                    <td className="p-4 font-bold">#{o.id}</td>
                                                    <td className="p-4">{o.customer}</td>
                                                    <td className="p-4 font-bold">{o.price} DH</td>
                                                    <td className="p-4">
                                                        <span className={`px-2 py-1 rounded text-xs ${
                                                            o.status === 'delivered' ? 'bg-green-100 text-green-700' :
                                                            o.status === 'assigned' ? 'bg-blue-100 text-blue-700' :
                                                            'bg-yellow-100 text-yellow-700'
                                                        }`}>
                                                            {o.status === 'delivered' ? 'ุชู ุงูุชุณููู' : 
                                                             o.status === 'assigned' ? 'ูู ุงูุทุฑูู' : 'ุงูุชุธุงุฑ'}
                                                        </span>
                                                    </td>
                                                    <td className="p-4 text-gray-500">{o.driver || '-'}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* === DRIVER VIEW === */}
                        {view === 'driver' && (
                            <div className="p-6 max-w-md mx-auto w-full animate-fade-in">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">ููุงูู ุงูููู</h2>
                                    <span className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">ูุชุตู</span>
                                </div>

                                <div className="space-y-4">
                                    {orders.filter(o => o.status === 'assigned').length === 0 && (
                                        <div className="text-center py-10 text-gray-400 border-2 border-dashed rounded-xl">
                                            ูุง ุชูุฌุฏ ุทูุจุงุช ุฌุงุฑูุฉ
                                        </div>
                                    )}

                                    {orders.filter(o => o.status === 'assigned').map(order => (
                                        <div key={order.id} className="bg-white rounded-2xl shadow-lg p-5 border border-gray-100 relative overflow-hidden">
                                            <div className="absolute top-0 left-0 w-2 h-full bg-blue-500"></div>
                                            
                                            <div className="flex justify-between items-start mb-4 pl-2">
                                                <div>
                                                    <h3 className="font-bold text-lg">{order.customer}</h3>
                                                    <p className="text-gray-500 text-sm flex items-center gap-1">
                                                        <i className="fa-solid fa-location-dot text-red-500"></i> {order.address}
                                                    </p>
                                                </div>
                                                <div className="text-xl font-bold text-blue-600">{order.price} DH</div>
                                            </div>

                                            <div className="grid grid-cols-2 gap-3 mt-4">
                                                {/* ุฒุฑ ุงูุงุชุตุงู */}
                                                <button 
                                                    onClick={() => handleContact(order.phone, order.customer)}
                                                    className="flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-800 py-3 rounded-xl font-bold transition"
                                                >
                                                    <i className="fa-solid fa-phone"></i> ุงุชุตุงู
                                                </button>

                                                {/* ุฒุฑ ุงูุชุณููู ุงูุขูู */}
                                                <button 
                                                    onClick={() => initiateDelivery(order.id)}
                                                    className="flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold shadow-lg transition transform active:scale-95"
                                                >
                                                    <i className="fa-solid fa-check-double"></i> ุชุณููู
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                    </main>

                    {/* === ูุงูุฐุฉ ุงูุชุญูู (OTP Modal) === */}
                    {showOtpModal && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl animate-fade-in text-center">
                                <div className="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                                    <i className="fa-solid fa-shield-halved"></i>
                                </div>
                                <h3 className="text-xl font-bold mb-2">ุชุฃููุฏ ุงูุงุณุชูุงู ุงูุขูู</h3>
                                <p className="text-gray-500 text-sm mb-6">
                                    ุงููุฑุฌู ุฅุฏุฎุงู ุงูููุฏ (4 ุฃุฑูุงู) ุงูุฐู ุชูุตู ุจู ุงูุฒุจูู ุนุจุฑ SMS ูุชุฃููุฏ ุงูุนูููุฉ.
                                </p>
                                
                                <input 
                                    type="number" 
                                    value={otpInput}
                                    onChange={(e) => setOtpInput(e.target.value)}
                                    placeholder="####" 
                                    className="w-full text-center text-3xl font-bold tracking-widest border-2 border-gray-200 rounded-xl p-3 mb-6 focus:border-blue-500 focus:outline-none"
                                    autoFocus
                                />

                                <div className="grid grid-cols-2 gap-3">
                                    <button onClick={() => setShowOtpModal(false)} className="py-3 rounded-xl font-bold text-gray-500 hover:bg-gray-100">
                                        ุฅูุบุงุก
                                    </button>
                                    <button onClick={verifyAndDeliver} className="py-3 rounded-xl font-bold bg-blue-600 text-white hover:bg-blue-700 shadow-lg">
                                        ุชุฃููุฏ ุงูููุฏ
                                    </button>
                                </div>
                                
                                {/* ุชุฐููุฑ ููููุฏ ูู ุฃุฌู ุงูุชุฌุฑุจุฉ */}
                                <div className="mt-4 text-xs text-gray-300">
                                    (ููุชุฌุฑุจุฉ ุงูููุฏ ูู: {verificationCode})
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SmartDeliveryApp />);

    </script>
</body>
</html>
